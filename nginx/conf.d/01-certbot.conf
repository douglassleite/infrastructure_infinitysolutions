# ===========================================
# Certbot HTTP Challenge Server
# Aceita requisições HTTP para validação Let's Encrypt
# e redireciona o resto para HTTPS
# ===========================================

# Domínios principais (sempre ativos)
server {
    listen 80;
    server_name www.infinityitsolutions.com.br
                infinityitsolutions.com.br
                personalweb.infinityitsolutions.com.br
                personalapi.infinityitsolutions.com.br
                wedding.infinityitsolutions.com.br;

    # Certbot challenge
    location /.well-known/acme-challenge/ {
        root /var/www/certbot;
    }

    # Redirect all other traffic to HTTPS
    location / {
        return 301 https://$host$request_uri;
    }
}

# Domínios adicionais (sites de casamento)
# Este bloco aceita qualquer domínio não listado acima
# Útil para novos domínios que ainda não têm SSL
server {
    listen 80 default_server;
    server_name _;

    # Certbot challenge
    location /.well-known/acme-challenge/ {
        root /var/www/certbot;
    }

    # Para domínios sem SSL, retorna 503 temporariamente
    # Quando o SSL for configurado, o redirect acontece no arquivo específico
    location / {
        return 503 "Site em configuracao. Tente novamente em alguns minutos.";
        add_header Content-Type text/plain;
    }
}
